const native={};window.native=native,(async()=>{function e(e,t){let a=native,n=e.split(".");for(let e=0;e<n.length;e++){let i=n[e];e!=n.length-1||a[i]?a[i]||(a[i]={}):a[i]=t,a=a[i]}return n[n.length-1]}let t=0,a={},n="__",i="__oject_describes",d=["window","window.parent","device"];async function o(n){let i={};if(native.__oject_describes[n]=i,!await new Promise((e,d)=>{a[t]={callback:e,target:i},chrome.webview.postMessage({Type:0,Id:t++,Name:n,Args:[]})}))return e(n,new Proxy(i,{get:(e,i,d)=>{if(null==e["__"+i])return e[i];let o=0;return e["__"+i].Type&&(o=1e4*e["__"+i].Type),e["__"+i].Field?new Promise((e,d)=>{a[t]=e,chrome.webview.postMessage({Type:o+1,Id:t++,Name:n,IsField:!0,Member:i,Args:[]})}):function(){let e=arguments,d=this;return new Promise((s,w)=>{a[t]=s;let r=[],l=0;for(let n of e){if("function"==typeof n){let e=t+.01;r.push(["__function__",e]),a[e]={that:d,method:n}}r.push(n)}chrome.webview.postMessage({Type:o+1,Id:t++,Name:n,IsField:!1,Member:i,Args:r})})}},set:(e,a,i)=>{if(null!=e["__"+a]){let d=0;e["__"+a].Type&&(d=1e4*e["__"+a].Type),chrome.webview.postMessage({Type:d+1,Id:t++,Name:n,IsField:!0,Member:a,Args:[i]})}else null!=e[a]||native.__oject_describes[n+"."+a]||chrome.webview.postMessage({Type:3,Name:n,IsField:!0,Member:a,Args:[typeof i]}),e[a]=i}})),i}async function s(){for(let e of d)await o(e);let e=!1;document.addEventListener("mousedown",t=>{t.button,e=Date.now()}),document.addEventListener("mousemove",t=>{e&&Date.now()-e>50&&native.window.dragWindow(t.pageX,t.pageY)}),document.addEventListener("mouseup",t=>{0==t.button&&(e=0)})}native.__oject_describes={},chrome.webview.addEventListener("message",e=>{if(0==e.data.Type){if(e.data.Data)for(let t of e.data.Data){let n={Field:t.Field,Type:t.Type};native.__oject_describes[e.data.ObjectName]["__"+t.Name]=n,a[e.data.Id]&&(a[e.data.Id].target["__"+t.Name]=n),Object.defineProperty(native.__oject_describes[e.data.ObjectName],"__"+t.Name,{enumerable:!1,writable:!0})}a[e.data.Id]&&a[e.data.Id].callback(null==e.data.Data)}else 1==e.data.Type?a[e.data.Id]&&a[e.data.Id](e.data.Data):2==e.data.Type&&a[e.data.Id].method.call(a[e.data.Id].that,e.data.Data);delete a[e.data.Id];for(let t in a)t<e.data.Id/2-10&&delete a[t]}),await s(),native.window.createWindow=async(t,a,n)=>{null!=n||a?null==n&&(n=a,a=t,t=null):(a=t,t=null,n=null);let i=await native.window._createWindow(t,a,n),d=e(i,await o(i));return native.window.subwindows[d].parent=native.window,native.window.subwindows[d]},native.window.data=new Proxy({},{get:(e,t)=>native.window.getData(t),set:(e,t,a)=>{native.window.setData(t,a)}}),native.window.parent&&(native.window.parent.data=new Proxy({},{get:function(e,t){return native.window.parent.getData(t)},set:function(e,t,a){native.window.parent.setData(t,a)}})),window.dispatchEvent(new Event("native")),setTimeout(()=>{chrome.webview.postMessage({Type:-2})},100)})();